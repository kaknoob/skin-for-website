<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skin Disease Detection</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
            background-color: #f0f8ff; /* ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
        }

        /* Navbar */
        .navbar {
            background-color: #1e90ff;
            padding: 15px 30px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .navbar h2 {
            margin: 0;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Menu links */
        .nav-links {
            display: flex;
            gap: 20px;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            transition: opacity 0.3s;
        }
        .nav-links a:hover {
            opacity: 0.8;
        }

        /* Hamburger Button */
        .menu-toggle {
            display: none;
            flex-direction: column;
            cursor: pointer;
            gap: 5px;
        }
        .menu-toggle div {
            width: 25px;
            height: 3px;
            background: white;
            border-radius: 3px;
        }

        /* Responsive Menu */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 60px;
                right: 20px;
                background: #1e90ff;
                padding: 10px;
                border-radius: 10px;
                box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            }
            .nav-links.active {
                display: flex;
            }
            .menu-toggle {
                display: flex;
            }
        }

        /* Container */
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        h1 {
            text-align: center;
            color: #1e3a8a;
            margin-bottom: 30px;
        }

        /* Upload & Results styles */
        .upload-area {
            border: 2px dashed #87cefa;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            background: #f8fcff;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #1e90ff;
            background-color: #eaf6ff;
        }
        .upload-area.dragover {
            border-color: #00bfff;
            background-color: #dff3ff;
        }

        #fileInput { display: none; }
        .btn {
            background-color: #00bfa6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn:hover { background-color: #009c87; transform: scale(1.03); }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .loading { display: none; text-align: center; margin: 20px 0; color: #00796b; font-weight: bold; }
        .results { margin-top: 30px; }
        .image-container { display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
        .image-box { flex: 1; min-width: 300px; }
        .image-box img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .detection-info {
            background: #f0fdf4;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #c6f6d5;
            margin: 10px 0;
        }
        .detection-item {
            background: #ffffff;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 5px solid #00bfa6;
        }
        .error {
            color: #721c24;
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .model-status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }
        .model-loading { background: #fff8e1; color: #856404; }
        .model-ready { background: #d1fae5; color: #065f46; }
        .model-error { background: #fdecea; color: #b91c1c; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <div class="navbar">
        <h2>ü©∫ Skin Disease Detector</h2>
        <div class="menu-toggle" onclick="toggleMenu()">
            <div></div><div></div><div></div>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="/">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
            <a href="#results">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à</a>
            <a href="https://github.com/kaknoob/skin-for-website" target="_blank">GitHub</a>
        </div>
    </div>

    <div class="container">
        <h1>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏£‡∏Ñ‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏î‡πâ‡∏ß‡∏¢ AI</h1>

        <div id="modelStatus" class="model-status model-loading">
            ‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î Model... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà
        </div>

        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <p>üì∑ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à</p>
            <p>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: JPG, PNG</p>
        </div>

        <input type="file" id="fileInput" accept="image/*">
        <div style="text-align: center;">
            <button class="btn" onclick="processImage()" id="processBtn" disabled>üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à</button>
        </div>

        <div class="loading" id="loading">
            ‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û...
        </div>

        <div id="results" class="results" style="display: none;">
            <h3>üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢</h3>
            <div id="detectionInfo" class="detection-info"></div>
            <div class="image-container">
                <div class="image-box">
                    <h4>‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</h4>
                    <img id="originalImage" src="" alt="Original">
                </div>
                <div class="image-box">
                    <h4>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</h4>
                    <img id="annotatedImage" src="" alt="Detected">
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleMenu() {
            document.getElementById('navLinks').classList.toggle('active');
        }

        let selectedFile = null;
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.querySelector('.upload-area');
        const processBtn = document.getElementById('processBtn');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const modelStatus = document.getElementById('modelStatus');

        checkModelStatus();

        function checkModelStatus() {
            fetch('/health')
                .then(response => response.json())
                .then(data => {
                    if (data.model_loaded) {
                        modelStatus.className = 'model-status model-ready';
                        modelStatus.innerHTML = '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡∏Ñ‡∏•‡∏≤‡∏™: ' + Object.values(data.classes).join(', ');
                        processBtn.disabled = false;
                    } else {
                        modelStatus.className = 'model-status model-error';
                        modelStatus.innerHTML = '‚ùå Model ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                    }
                })
                .catch(() => {
                    modelStatus.className = 'model-status model-error';
                    modelStatus.innerHTML = '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Backend ‡πÑ‡∏î‡πâ';
                });
        }

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                selectedFile = e.target.files[0];
                uploadArea.innerHTML = `<p>‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå: ${selectedFile.name}</p>`;
                processBtn.disabled = false;
            }
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                selectedFile = e.dataTransfer.files[0];
                fileInput.files = e.dataTransfer.files;
                uploadArea.innerHTML = `<p>‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå: ${selectedFile.name}</p>`;
                processBtn.disabled = false;
            }
        });

        async function processImage() {
            if (!selectedFile) return;
            loading.style.display = 'block';
            results.style.display = 'none';
            processBtn.disabled = true;

            try {
                const base64 = await fileToBase64(selectedFile);
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({image: base64})
                });

                const result = await response.json();
                if (result.success) displayResults(result, base64);
                else showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.error);
            } catch (error) {
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ' + error.message);
            } finally {
                loading.style.display = 'none';
                processBtn.disabled = false;
            }
        }

        function displayResults(result, originalImageB64) {
            if (!originalImageB64.startsWith('data:image')) {
                originalImageB64 = `data:image/png;base64,${originalImageB64}`;
            }
            document.getElementById('originalImage').src = originalImageB64;
            document.getElementById('annotatedImage').src = result.annotated_image;

            let infoHtml = `<h4>üéØ ‡∏û‡∏ö ${result.total_detections} ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö</h4>`;
            result.detections.forEach((detection) => {
               infoHtml += `
                <div class="detection-item">
                    <strong>${detection.class}</strong> 
                    (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥: ${(detection.confidence * 100).toFixed(1)}%)<br>
                    üìå ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${detection.advice || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥"}<br>
                    ${detection.more_info ? `<a href="${detection.more_info}" target="_blank" class="read-more">üìñ ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</a>` : ""}
                </div>`;

            });

            document.getElementById('detectionInfo').innerHTML = infoHtml;
            results.style.display = 'block';
        }

        function showError(message) {
            results.innerHTML = `<div class="error">${message}</div>`;
            results.style.display = 'block';
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
            });
        }

        setInterval(checkModelStatus, 30000);
    </script>
</body>
</html>
